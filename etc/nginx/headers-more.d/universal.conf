include snippets/universal_paths.conf;

# ======================================= #

proxy_hide_header Cross-Origin-Resource-Policy;
more_set_headers "Cross-Origin-Resource-Policy: same-origin";

proxy_hide_header Cross-Origin-Opener-Policy;
more_set_headers "Cross-Origin-Opener-Policy: same-origin";

# Change COEP to "credentialless" when supported by Safari
# https://developer.mozilla.org/en-US/docs/Web/API/Window/credentialless
proxy_hide_header Cross-Origin-Embedder-Policy;
more_set_headers "Cross-Origin-Embedder-Policy: require-corp" always;

# ======================================= #

# We do not set clipboard-write() here, because it is very commonly used
proxy_hide_header Permissions-Policy;
more_set_headers "Permissions-Policy: accelerometer=(), ambient-light-sensor=(), autoplay=(), battery=(), bluetooth=(), browsing-topics=(), camera=(), clipboard-read=(), display-capture=(), document-domain=(), encrypted-media=(), fullscreen=(), gamepad=(), geolocation=(), gyroscope=(), hid=(), idle-detection=(), interest-cohort=(), keyboard-map=(), local-fonts=(), magnetometer=(), microphone=(), midi=(), payment=(), picture-in-picture=(), publickey-credentials-create=self, publickey-credentials-get=self, screen-wake-lock=(), serial=(), speaker-selection=(), sync-xhr=(), usb=(), xr-spatial-tracking=()";

# ======================================= #

quic_retry on;
more_set_headers "Alt-Svc: 'h3=\":443\"; ma=86400";

# ======================================= #

proxy_hide_header X-Robots-Tag;
more_set_headers "X-Robots-Tag: noindex, nofollow" always;

# ======================================= #


proxy_hide_header Strict-Transport-Security;
more_set_headers "Strict-Transport-Security: max-age=31536000; includeSubDomains; preload";

proxy_hide_header Access-Control-Max-Age;
more_set_headers "Access-Control-Max-Age: 600";

proxy_hide_header Referrer-Policy;
more_set_headers "Referrer-Policy: same-origin";

proxy_hide_header X-Content-Type-Options;
more_set_headers "X-Content-Type-Options: nosniff";

proxy_hide_header X-Permitted-Cross-Domain-Policies;
more_set_headers "X-Permitted-Cross-Domain-Policies: none";

# Obsolete and replaced by Content-Security-Policy
# Only here to pass Hardenize checks
proxy_hide_header X-XSS-Protection;
more_set_headers "X-XSS-Protection: 0";

# Limit allowed methods
if ( $request_method !~ ^(DELETE|GET|HEAD|OPTIONS|PATCH|POST|PUT)$ ) {
    return 405;
}